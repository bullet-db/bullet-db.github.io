<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The full documentation for Bullet - A Real Time Data Query Engine"> 
    <meta name="author" content="Akshai Sarma"> 
    <link rel="canonical" href="https://bullet-db.github.io/backend/storm-setup/"> 
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Setup - Bullet Docs</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

    
    
      
    
    
    <style>
        /* Collapse ToC */
        .bs-sidebar .nav .nav {
            display: none;
        }
    </style>
    
</head>

<body data-spy="scroll" data-target=".bs-sidebar">

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Bullet Docs<small class="small small-brand-text">v1.1.0</small></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Quick Start <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../quick-start/spark/">Spark</a>
</li>

                        
                            
<li >
    <a href="../../quick-start/storm/">Storm</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Backend <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Data Ingestion</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../ingestion/">Record Container</a>
</li>

        
            
<li >
    <a href="../dsl/">DSL</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Storm</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../storm-architecture/">Architecture</a>
</li>

        
            
<li class="active">
    <a href="./">Setup</a>
</li>

        
            
<li >
    <a href="../storm-performance/">Performance</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Spark</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../spark-architecture/">Architecture</a>
</li>

        
            
<li >
    <a href="../spark-setup/">Setup</a>
</li>

        
            
<li >
    <a href="../spark-performance/">Performance</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">PubSub <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../pubsub/architecture/">Architecture</a>
</li>

                        
                            
<li >
    <a href="../../pubsub/kafka/">Kafka</a>
</li>

                        
                            
<li >
    <a href="../../pubsub/rest/">REST</a>
</li>

                        
                            
<li >
    <a href="../../pubsub/pulsar/">Pulsar</a>
</li>

                        
                            
<li >
    <a href="../../pubsub/storm-drpc/">Storm DRPC</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Web Service <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../ws/setup/">Setup</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">API</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../ws/api/">BQL</a>
</li>

        
            
<li >
    <a href="../../ws/examples/">Examples</a>
</li>

        
            
<li >
    <a href="../../ws/api-json/">JSON (DEPRECATED)</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">UI <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../ui/setup/">Setup</a>
</li>

                        
                            
<li >
    <a href="../../ui/usage/">Usage</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../releases/">Releases</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../about/contributing/">Contributing</a>
</li>

                        
                            
<li >
    <a href="../../about/contact/">Contact Us</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                  </li>
                
                
                    <li >
                        <a rel="next" href="../storm-architecture/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../storm-performance/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/bullet-db">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3">

  

<div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="active">
            <a href="#bullet-on-storm">Bullet on Storm</a>
            <ul class="nav">
                
                    <li class="second-level">
                        <a href="#configuration">Configuration</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#installation">Installation</a>
                        <ul class="nav">
                        
                            <li class="third-level">
                                <a href="#older-storm-versions">Older Storm Versions</a>
                                
                            </li>
                        
                        </ul>
                    </li>
            
                    <li class="second-level">
                        <a href="#launch">Launch</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#using-bullet-dsl">Using Bullet DSL</a>
                        <ul class="nav">
                        
                            <li class="third-level">
                                <a href="#setup">Setup</a>
                                
                            </li>
                        
                        </ul>
                    </li>
            
                    <li class="second-level">
                        <a href="#storage-and-replay">Storage and Replay</a>
                        
                    </li>
            
            </ul>
        </li>
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="bullet-on-storm">Bullet on Storm</h1>
<p>This section explains how to set up and run Bullet on Storm. If you're using the Storm DRPC PubSub, refer to <a href="../../pubsub/storm-drpc/">this section</a> for further details.</p>
<h2 id="configuration">Configuration</h2>
<p>Bullet is configured at run-time using settings defined in a file. Settings not overridden will default to the values in <a href="https://github.com/bullet-db/bullet-storm/blob/master/src/main/resources/bullet_defaults.yaml">bullet_defaults.yaml</a>. There are too many to list here. You can find out what these settings do in the comments listed in the defaults.</p>
<h2 id="installation">Installation</h2>
<p>To use Bullet, you need to implement a way to read from your data source and convert your data into Bullet Records (bullet-record is a transitive dependency for Bullet and can be found in <a href="../ingestion/#installing-the-record-directly">Maven Central</a>. You have a couple of options in how to get your data into Bullet:</p>
<ol>
<li>You can implement a spout (or even a topology) that reads from your data source and emits Bullet Records. You then write a main class that submits the topology with your topology wired in <a href="https://github.com/bullet-db/bullet-storm/blob/master/src/main/java/com/yahoo/bullet/storm/StormUtils.java">using our submit methods</a>.</li>
<li>Use Bullet DSL to configure a spout (and optionally a bolt) that you provide in the settings to our main class. This will wire up your data source and data format to Bullet without you having to write code!</li>
</ol>
<p>You can refer to the <a href="../storm-architecture/#data-processing">Pros and Cons</a> of the various approaches to determine what works best for you.</p>
<p>You need a JVM based project that implements one of the two options above. You include the Bullet artifact and Storm dependencies in your pom.xml or other dependency management system. The artifacts are available through Maven Central.</p>
<pre><code class="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.storm&lt;/groupId&gt;
  &lt;artifactId&gt;storm-core&lt;/artifactId&gt;
  &lt;version&gt;${storm.version}&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;com.yahoo.bullet&lt;/groupId&gt;
  &lt;artifactId&gt;bullet-storm&lt;/artifactId&gt;
  &lt;version&gt;${bullet.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>If you just need the jar artifact directly, you can download it from <a href="https://repo1.maven.org/maven2/com/yahoo/bullet/bullet-storm/">Maven Central</a>.</p>
<p>You can also add <code>&lt;classifier&gt;sources&lt;/classifier&gt;</code>  or <code>&lt;classifier&gt;javadoc&lt;/classifier&gt;</code> if you want the sources or javadoc. We also package up our test code where we have some helper classes to deal with <a href="https://github.com/bullet-db/bullet-storm/tree/master/src/test/java/com/yahoo/bullet/storm">Storm components</a>. If you wish to use these to help with testing your topology, you can add another dependency on bullet-storm with <code>&lt;type&gt;test-jar&lt;/type&gt;</code>.</p>
<p>If you are going to use the second option (directly pipe data into Bullet from your Storm topology), then you will need a main class that directly calls the submit method with your wired up topology and the name of the component that is going to emit Bullet Records in that wired up topology. The submit method can be found in <a href="https://github.com/bulletbullet-storm/blob/master/src/main/java/com/yahoo/bullet/Topology.java">Topology.java</a>. The submit method submits the topology so it should be the last thing you do in your main.</p>
<p>If you are just implementing a spout, see the <a href="#launch">Launch</a> section below on how to use the main class in Bullet to create and submit your topology.</p>
<p>Storm topologies are generally launched with "fat" jars (jar-with-dependencies), excluding storm itself:</p>
<pre><code class="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.4&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;assemble-all&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;single&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
    &lt;configuration&gt;
        &lt;descriptorRefs&gt;
            &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;
        &lt;/descriptorRefs&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre>

<h3 id="older-storm-versions">Older Storm Versions</h3>
<p>Since package prefixes changed from <code>backtype.storm</code> to <code>org.apache.storm</code> in Storm 1.0 and above, you will need to get the storm-0.10 version of Bullet if
your Storm cluster is still not at 1.0 or higher. These older packages are only available in JCenter, which is already sunset but available in read-only
mode. We recommend you do not use those versions and migrate to Bullet Storm versions greater than 1.1.2 as soon as possible. If you still
need them, you can change your dependency to:</p>
<pre><code class="xml">&lt;repositories&gt;
    &lt;repository&gt;
        &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
        &lt;/snapshots&gt;
        &lt;id&gt;central&lt;/id&gt;
        &lt;name&gt;bintray&lt;/name&gt;
        &lt;url&gt;http://jcenter.bintray.com&lt;/url&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;
</code></pre>

<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.yahoo.bullet&lt;/groupId&gt;
    &lt;artifactId&gt;bullet-storm-0.10&lt;/artifactId&gt;
    &lt;version&gt;${bullet.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>You can also add <code>&lt;classifier&gt;sources&lt;/classifier&gt;</code>  or <code>&lt;classifier&gt;javadoc&lt;/classifier&gt;</code> if you want the source or javadoc and <code>&lt;type&gt;test-jar&lt;/type&gt;</code> for the test classes as with bullet-storm.</p>
<p>Also, since storm-metrics and the Resource Aware Scheduler are not in Storm versions less than 1.0, there are changes in the Bullet settings. The settings that set the CPU and memory loads do not exist (so the config file does not specify them). The setting to enable the topology scheduler are no longer present (you can still override these settings if you run a custom version of Storm by passing it to the storm jar command. <a href="#launch">See below</a>.) You can take a look the settings file on the storm-0.10 branch in the Git repo.</p>
<p>If for some reason, you are running a version of Storm less than 1.0 that has the RAS back-ported to it and you wish to set the CPU and other settings, you will your own main class that mirrors the master branch of the main class but with backtype.storm packages instead.</p>
<h2 id="launch">Launch</h2>
<p>If you have implemented your own main class (option 2 above), you just pass your main class to the storm executable as usual. If you are implementing a spout, here's an example of how you could launch the topology:</p>
<pre><code class="bash">storm jar your-fat-jar-with-dependencies.jar \
          com.yahoo.bullet.Topology \
          --bullet-conf path/to/the/bullet_settings.yaml \
          -c topology.acker.executors=64 \
          -c topology.max.spout.pending=10000
</code></pre>

<p>And in your bullet_settings.yaml, you would have, for example:</p>
<pre><code class="yaml">bullet.topology.bullet.spout.class.name: &quot;full.package.prefix.to.your.spout.implementation&quot;
bullet.topology.bullet.spout.args: [&quot;arg-to-your-spout-class-for-example-a-path-to-a-config-file&quot;, &quot;another-arg-to-your-spout-class&quot;]
bullet.topology.bullet.spout.parallelism: 64
bullet.topology.bullet.spout.cpu.load: 200.0
bullet.topology.bullet.spout.memory.on.heap.load: 512.0
bullet.topology.bullet.spout.memory.off.heap.load: 256.0
</code></pre>

<p>You can pass other arguments to Storm using the -c argument. The example above uses 64 ackers, for example and uses Storm's <a href="http://storm.apache.org/releases/1.1.0/Guaranteeing-message-processing.html">reliable message processing mechanisms</a>. Certain components in the Bullet Storm topology cannot be reliable due to how Bullet operates currently. Hundreds of millions of Storm tuples could go into any query running in Bullet and it is intractable to <em>anchor</em> a single Bullet aggregation to those tuples, particularly when the results are approximate. However, you should enable acking to ensure at least once message deliveries for the hop from your topology (or spout) to the Filter bolts and for the Query spouts to the Filter and Join bolts. Ackers are lightweight so you need not have the same number of tasks as components that ack in your topology so you can tweak it accordingly. The example above also sets max spout pending to control how fast the spout emits. You could use the back-pressure mechanisms in Storm in addition or in lieu of as you choose. We have found that max spout pending gives a much more predictable way of throttling our spouts during catch up or data spikes.</p>
<div class="admonition note">
<p class="admonition-title">Main Class Arguments</p>
<p>If you run the main class without arguments or pass in the <code>--help</code> argument, you can see what these arguments mean and what others are supported.</p>
</div>
<h2 id="using-bullet-dsl">Using Bullet DSL</h2>
<p>Instead of implementing your own spout or Topology, you can also use the provided DSL spout (and optionally, DSL bolt) with <a href="../dsl/">Bullet DSL</a>. To do so, add the following settings to your YAML configuration:</p>
<pre><code class="yaml">bullet.topology.dsl.spout.enable: true
bullet.topology.dsl.spout.parallelism:
bullet.topology.dsl.spout.cpu.load:
bullet.topology.dsl.spout.memory.on.heap.load:
bullet.topology.dsl.spout.memory.off.heap.load:

bullet.topology.dsl.bolt.enable: false
bullet.topology.dsl.bolt.parallelism:
bullet.topology.dsl.bolt.cpu.load:
bullet.topology.dsl.bolt.memory.on.heap.load:
bullet.topology.dsl.bolt.memory.off.heap.load:

bullet.topology.dsl.deserializer.enable: false
</code></pre>

<p>If the DSL bolt is enabled in addition to the spout (the spout is always required!), Storm will read your data in the spout and convert it in the bolt. Without the bolt, reading and converting are done entirely in the spout. If you wish to separate the two by enabling the DSL bolt, you can lower per-worker latencies when data volume is large and scale them independently.</p>
<p>There is also a setting to enable <a href="../dsl/#bulletdeserializer">BulletDeserializer</a>, which is an optional component of Bullet DSL for deserializing data between reading and converting.  </p>
<h4 id="setup">Setup</h4>
<p>The Bullet Storm jar is not built with Bullet DSL or with other dependencies you may want such as Kafka and Pulsar. Instead, you will have to either add the dependencies (the DSL fat jar and your particular connector dependencies) to the Storm launcher and worker environments or build a fat jar with the dependencies. In Storm 1.2.2+, however, you also have the option of directly adding the following jars to the classpath in the <code>storm jar</code> command.</p>
<h5 id="kafka">Kafka</h5>
<p><a href="https://repo1.maven.org/maven2/org/apache/kafka/kafka-clients/2.6.1/">Kafka Clients 2.6.1</a></p>
<h5 id="pulsar">Pulsar</h5>
<p><a href="https://repo1.maven.org/maven2/org/apache/pulsar/pulsar-client/2.2.1/">Pulsar Client 2.2.1</a></p>
<p><a href="https://repo1.maven.org/maven2/org/apache/pulsar/pulsar-client-schema/2.2.1/">Pulsar Client Schema 2.2.1</a></p>
<p><a href="https://repo1.maven.org/maven2/org/apache/pulsar/protobuf-shaded/2.1.1-incubating/">Pulsar Protobuf Shaded 2.1.1-incubating</a></p>
<h5 id="example">Example</h5>
<p>The following is an example for Pulsar in Storm 1.2.2+:</p>
<pre><code>
storm jar bullet-storm-1.3.0.jar \
          com.yahoo.bullet.storm.Topology \
          --bullet-conf ./bullet_settings.yaml \
          --jars &quot;bullet-dsl-1.2.0.jar,pulsar-client-2.2.1.jar,pulsar-client-schema-2.2.1.jar,protobuf-shaded-2.1.1-incubating.jar&quot;
</code></pre>

<h2 id="storage-and-replay">Storage and Replay</h2>
<p>If you set up the <a href="../../ws/setup/#storage-configuration">Storage layer in the Web Service</a>, you can turn on the replaying feature in Bullet on Storm. This wires up the Replay bolts to the topology. This component keeps track of the queries in the backend and replays queries from the Storage layer upon restart or component failure.</p>
<p>Currently, only queries are stored. In the future, the Storage module will also be used for storing intermediate results in addition to queries to accommodate for restarts or component failures without loss of data for executing queries.</p></div>
        
    </div>

    <footer class="col-md-12" >
        <hr />
        <div class="pull-left col-md-6">
            
            
        </div>
        <div class="pull-right col-md-4 text-right">
            <p>
            <small>Bullet is licensed under the <a href='https://github.com/bullet-db/bullet-core/blob/master/LICENSE'>Apache 2 license</a>.<br></small>
            
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
        </div>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
