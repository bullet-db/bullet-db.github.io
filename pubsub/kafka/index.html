<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The full documentation for Bullet - A Real Time Data Query Engine"> 
    <meta name="author" content="Akshai Sarma"> 
    <link rel="canonical" href="https://bullet-db.github.io/pubsub/kafka/"> 
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Kafka - Bullet Docs</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

    
    
      
    
    
    <style>
        /* Collapse ToC */
        .bs-sidebar .nav .nav {
            display: none;
        }
    </style>
    
</head>

<body data-spy="scroll" data-target=".bs-sidebar">

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Bullet Docs<small class="small small-brand-text">v0.5.2</small></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Quick Start <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../quick-start/spark/">Spark</a>
</li>

                        
                            
<li >
    <a href="../../quick-start/storm/">Storm</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Backend <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../backend/ingestion/">Getting your data into Bullet</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Storm</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../backend/storm-architecture/">Architecture</a>
</li>

        
            
<li >
    <a href="../../backend/storm-setup/">Setup</a>
</li>

        
            
<li >
    <a href="../../backend/storm-performance/">Performance</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Spark</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../backend/spark-architecture/">Architecture</a>
</li>

        
            
<li >
    <a href="../../backend/spark-setup/">Setup</a>
</li>

        
            
<li >
    <a href="../../backend/spark-performance/">Performance</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">PubSub <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../architecture/">Architecture</a>
</li>

                        
                            
<li class="active">
    <a href="./">Kafka</a>
</li>

                        
                            
<li >
    <a href="../rest/">REST</a>
</li>

                        
                            
<li >
    <a href="../storm-drpc/">Storm DRPC</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Web Service <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../ws/setup/">Setup</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">API</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../ws/api-json/">JSON</a>
</li>

        
            
<li >
    <a href="../../ws/api-bql/">BQL</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../ws/examples/">Query Examples</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">UI <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../ui/setup/">Setup</a>
</li>

                        
                            
<li >
    <a href="../../ui/usage/">Usage</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../releases/">Releases</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../about/contributing/">Contributing</a>
</li>

                        
                            
<li >
    <a href="../../about/contact/">Contact Us</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                  </li>
                
                
                    <li >
                        <a rel="next" href="../architecture/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../rest/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/bullet-db">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3">

  

<div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="active">
            <a href="#kafka-pubsub">Kafka PubSub</a>
            <ul class="nav">
                
                    <li class="second-level">
                        <a href="#how-does-it-work">How does it work?</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#setup">Setup</a>
                        <ul class="nav">
                        
                            <li class="third-level">
                                <a href="#plug-into-the-backend">Plug into the Backend</a>
                                
                            </li>
                        
                            <li class="third-level">
                                <a href="#plug-into-the-web-service">Plug into the Web Service</a>
                                
                            </li>
                        
                        </ul>
                    </li>
            
                    <li class="second-level">
                        <a href="#passthrough-configuration">Passthrough Configuration</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#partitions">Partitions</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#security">Security</a>
                        <ul class="nav">
                        
                            <li class="third-level">
                                <a href="#storm">Storm</a>
                                
                            </li>
                        
                        </ul>
                    </li>
            
            </ul>
        </li>
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="kafka-pubsub">Kafka PubSub</h1>
<p>The Kafka implementation of the Bullet PubSub can be used on any Backend and Web Service. It uses <a href="https://kafka.apache.org">Apache Kafka</a> as the backing PubSub queue and works on all Backends.</p>
<h2 id="how-does-it-work">How does it work?</h2>
<p>The implementation by default asks you to create two topics in a Kafka cluster - one for queries and another for results. The Web Service publishes queries to the queries topic and reads results from the results topic. Similarly, the Backend reads queries from the queries topic and writes results to the results topic. All messages are sent as <a href="../architecture/#messages">PubSubMessages</a>.</p>
<p>You do not need to have two topics. You can have one but you should use multiple partitions and configure your Web Service and Backend to produce to and consume from the right partitions. See the <a href="#configuration">setup</a> section for more details.</p>
<div class="admonition note">
<p class="admonition-title">Kafka Client API</p>
<p>The Bullet Kafka implementation uses the Kafka 0.10.2 client APIs. Generally, your forward or backward compatibilities should work as expected.</p>
</div>
<h2 id="setup">Setup</h2>
<p>Before setting up, you will need a Kafka cluster setup with your topic(s) created. This cluster need only be a couple of machines if it's devoted for Bullet. However, this depends on your query and result volumes. Generally, these are at most a few hundred or thousands of messages per second and a small Kafka cluster will suffice.</p>
<p>To setup Kafka, follow the <a href="https://kafka.apache.org/quickstart">instructions here</a>.</p>
<h3 id="plug-into-the-backend">Plug into the Backend</h3>
<p>Depending on how your Backend is built, either add Bullet Kafka to your classpath or include it in your build tool. Head over to our <a href="../../releases/#bullet-kafka">releases page</a> for getting the artifacts. If you're adding Bullet Kafka to the classpath instead of building a fat jar, you will need to get the jar with the classifier: <code>fat</code> since you will need Bullet Kafka and all its dependencies.</p>
<p>Configure the backend to use the Kafka PubSub:</p>
<pre><code class="yaml">bullet.pubsub.context.name: &quot;QUERY_PROCESSING&quot;
bullet.pubsub.class.name: &quot;com.yahoo.bullet.kafka.KafkaPubSub&quot;
bullet.pubsub.kafka.bootstrap.servers: &quot;server1:port1,server2:port2,...&quot;
bullet.pubsub.kafka.request.topic.name: &quot;your-query-topic&quot;
bullet.pubsub.kafka.response.topic.name: &quot;your-result-topic&quot;
</code></pre>

<p>You will then need to configure the Publishers and Subscribers. For details on what to configure and what the defaults are, see the <a href="https://github.com/bullet-db/bullet-kafka/blob/master/src/main/resources/bullet_kafka_defaults.yaml">configuration file</a>.</p>
<h3 id="plug-into-the-web-service">Plug into the Web Service</h3>
<p>You will need the Head over to our <a href="../../releases/#bullet-kafka">releases page</a> and get the JAR artifact with the <code>fat</code> classifier. For example, you can download the artifact for the 0.2.0 release <a href="http://jcenter.bintray.com/com/yahoo/bullet/bullet-kafka/0.2.0/">directly from JCenter</a>).</p>
<p>You should then plug in this JAR to your Web Service following the instructions <a href="../../ws/setup/#launch">here</a>.</p>
<p>For configuration, you should <a href="../../ws/setup/#pubsub-configuration">follow the steps here</a> to create and provide a YAML file to the Web Service. Remember to change the context to <code>QUERY_SUBMISSION</code>.</p>
<pre><code class="yaml">bullet.pubsub.context.name: &quot;QUERY_SUBMISSION&quot;
bullet.pubsub.class.name: &quot;com.yahoo.bullet.kafka.KafkaPubSub&quot;
bullet.pubsub.kafka.bootstrap.servers: &quot;server1:port1,server2:port2,...&quot;
bullet.pubsub.kafka.request.topic.name: &quot;your-query-topic&quot;
bullet.pubsub.kafka.response.topic.name: &quot;your-result-topic&quot;
</code></pre>

<p>As with the Backend, you will then need to configure the Publishers and Subscribers. See the <a href="https://github.com/bullet-db/bullet-kafka/blob/master/src/main/resources/bullet_kafka_defaults.yaml">configuration file</a>. Remember that your Subscribers in the Backend are reading what the Producers in your Web Service are producing and vice-versa, so make sure to match up the topics and settings accordingly if you have any custom changes.</p>
<h2 id="passthrough-configuration">Passthrough Configuration</h2>
<p>You can pass additional Kafka Producer or Consumer properties to the PubSub Publishers and Subscribers by prefixing them with either <code>bullet.pubsub.kafka.producer.</code> for Producers or <code>bullet.pubsub.kafka.consumer.</code> for Consumers. The PubSub configuration uses and provides a few defaults for settings it thinks is important to manage. You can tweak them and add others. For a list of properties that you can configure, see the <a href="https://kafka.apache.org/0102/documentation.html#producerconfigs">Producer</a> or <a href="https://kafka.apache.org/0102/documentation.html#newconsumerconfigs">Consumer</a> configs in Kafka.</p>
<div class="admonition note">
<p class="admonition-title">Types for the properties</p>
<p>All Kafka properties are better off specified as Strings since Kafka type casts them accordingly. If you provide types, you might run into issues where YAML types do not match what the Kafka client is expecting.</p>
</div>
<h2 id="partitions">Partitions</h2>
<p>You may choose to partition your topics for a couple of reasons:</p>
<ol>
<li>You may have one topic for both queries and responses and use partitions as a way to separate them.</li>
<li>You may use two topics and partition one or both for scalability when reading and writing</li>
<li>You may use two topics and partition one or both for sharding across multiple Web Service instances (and multiple instances in your Backend)</li>
</ol>
<p>You can accomplish all this with partition maps. You can configure what partitions your Publishers (Web Service or Backend) will write to using <code>bullet.pubsub.kafka.request.partitions</code> and what partitions your Subscribers will read from using <code>bullet.pubsub.kafka.response.partitions</code>. Providing these to an instance of the Web Service or the Backend in the YAML file ensures that the Publishers in that instance only write to these request partitions and Subscribers only read from the response partitions. The Publishers will randomly adds one of the response partitions in the messages sent to ensure that the responses only arrive to one of those partitions this instance's Subscribers are waiting on. For more details, see the <a href="https://github.com/bullet-db/bullet-kafka/blob/master/src/main/resources/bullet_kafka_defaults.yaml">configuration file</a>.</p>
<h2 id="security">Security</h2>
<p>If you're using secure Kafka, you will need to do the necessary metadata setup to make sure your principals have access to your topic(s) for reading and writing. If you're using SSL for securing your Kafka cluster, you will need to add the necessary SSL certificates to the keystore for your JVM before launching the Web Service or the Backend.</p>
<h3 id="storm">Storm</h3>
<p>We have tested Kafka with <a href="../../releases/#bullet-storm">Bullet Storm</a> using <code>Kerberos</code> from the Storm cluster and SSL from the Web Service. For Kerberos, you may need to add a <code>JAAS</code> <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/security/jgss/tutorials/LoginConfigFile.html">config file</a> to the <a href="http://storm.apache.org/releases/1.1.0/distcache-blobstore.html">Storm BlobStore</a> and add it to your worker JVMs. To do this, you will need a JAAS configuration entry. For example, if your Kerberos KDC is shared with your Storm cluster's KDC, you may be adding a jaas_file.conf with</p>
<pre><code>KafkaClient {
   org.apache.storm.security.auth.kerberos.AutoTGTKrb5LoginModule required
   serviceName=&quot;kafka&quot;;
};
</code></pre>

<p>Put this file into Storm's BlobStore using:</p>
<pre><code>storm blobstore create --file jaas_file.conf --acl o::rwa,u:$USER:rwa --repl-fctr 3 jaas_file.conf
</code></pre>

<p>Then while launching your topology, you should provide as arguments to the <code>storm jar</code> command, the following arguments:</p>
<pre><code>-c topology.blobstore.map='{&quot;jaas_file.conf&quot;: {} }' \
-c topology.worker.childopts=&quot;-Djava.security.auth.login.config=./jaas_file.conf&quot; \
</code></pre>

<p>This will add this to all your worker JVMs. You can refresh Kerberos credentials periodically and push credentials to Storm as <a href="../storm-drpc/#security">mentioned here</a>.</p></div>
        
    </div>

    <footer class="col-md-12" >
        <hr />
        <div class="pull-left col-md-6">
            
            
        </div>
        <div class="pull-right col-md-4 text-right">
            <p>
            <small>Bullet is licensed under the <a href='https://github.com/bullet-db/bullet-core/blob/master/LICENSE'>Apache 2 license</a>.<br></small>
            
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
        </div>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
