<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The full documentation for Bullet - A Real Time Data Query Engine"> 
    <meta name="author" content="Akshai Sarma"> 
    <link rel="canonical" href="https://bullet-db.github.io/ws/examples/"> 
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Query Examples - Bullet Docs</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

    
    
      
    
    
    <style>
        /* Collapse ToC */
        .bs-sidebar .nav .nav {
            display: none;
        }
    </style>
    
</head>

<body data-spy="scroll" data-target=".bs-sidebar">

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Bullet Docs<small class="small small-brand-text">v0.5.2</small></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Quick Start <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../quick-start/spark/">Spark</a>
</li>

                        
                            
<li >
    <a href="../../quick-start/storm/">Storm</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Backend <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../backend/ingestion/">Getting your data into Bullet</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Storm</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../backend/storm-architecture/">Architecture</a>
</li>

        
            
<li >
    <a href="../../backend/storm-setup/">Setup</a>
</li>

        
            
<li >
    <a href="../../backend/storm-performance/">Performance</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Spark</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../backend/spark-architecture/">Architecture</a>
</li>

        
            
<li >
    <a href="../../backend/spark-setup/">Setup</a>
</li>

        
            
<li >
    <a href="../../backend/spark-performance/">Performance</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">PubSub <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../pubsub/architecture/">Architecture</a>
</li>

                        
                            
<li >
    <a href="../../pubsub/kafka/">Kafka</a>
</li>

                        
                            
<li >
    <a href="../../pubsub/rest/">REST</a>
</li>

                        
                            
<li >
    <a href="../../pubsub/storm-drpc/">Storm DRPC</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Web Service <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../setup/">Setup</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">API</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../api-json/">JSON</a>
</li>

        
            
<li >
    <a href="../api-bql/">BQL</a>
</li>

        
    </ul>
  </li>

                        
                            
<li class="active">
    <a href="./">Query Examples</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">UI <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../ui/setup/">Setup</a>
</li>

                        
                            
<li >
    <a href="../../ui/usage/">Usage</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../releases/">Releases</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../about/contributing/">Contributing</a>
</li>

                        
                            
<li >
    <a href="../../about/contact/">Contact Us</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                  </li>
                
                
                    <li >
                        <a rel="next" href="../api-bql/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../ui/setup/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/bullet-db">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3">

  

<div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="active">
            <a href="#query-examples">Query Examples</a>
            <ul class="nav">
                
                    <li class="second-level">
                        <a href="#simplest-query">Simplest Query</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#simple-filtering">Simple Filtering</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#relational-filters-and-projections">Relational Filters and Projections</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#logical-filters-and-projections">Logical Filters and Projections</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#group-all-count-aggregation">GROUP ALL COUNT Aggregation</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#group-all-multiple-aggregations">GROUP ALL Multiple Aggregations</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#exact-count-distinct-aggregation">Exact COUNT DISTINCT Aggregation</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#approximate-count-distinct">Approximate COUNT DISTINCT</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#distinct-aggregation">DISTINCT Aggregation</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#group-by-aggregation">GROUP by Aggregation</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#quantile-distribution">QUANTILE DISTRIBUTION</a>
                        <ul class="nav">
                        
                            <li class="third-level">
                                <a href="#normalized-rank-error">Normalized Rank Error</a>
                                
                            </li>
                        
                        </ul>
                    </li>
            
                    <li class="second-level">
                        <a href="#pmf-distribution-aggregation">PMF DISTRIBUTION Aggregation</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#cdf-distribution-aggregation">CDF DISTRIBUTION Aggregation</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#exact-top-k-aggregation">Exact TOP K Aggregation</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#approximate-top-k-aggregation">Approximate TOP K Aggregation</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#window-tumbling-group-by">Window - Tumbling Group-By</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#window-additive-tumbling">Window - Additive Tumbling</a>
                        
                    </li>
            
                    <li class="second-level">
                        <a href="#sliding-reactive-window-with-max-duration">Sliding "Reactive" Window with Max Duration</a>
                        
                    </li>
            
            </ul>
        </li>
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h2 id="query-examples">Query Examples</h2>
<p>Rather than sourcing the examples from the Quick Start, these examples are real-world ones sourced from Bullet running on raw, user events generated by instrumentation on Yahoo sites by Yahoo employees (not all Yahoo users).</p>
<div class="admonition note">
<p class="admonition-title">Disclaimer</p>
<p>The actual data shown here has been edited and is not how actual Yahoo user events look.</p>
</div>
<div class="admonition note">
<p class="admonition-title">SQL translation</p>
<p>For each query, we will also rewrite it to a SQL like syntax for readability. Eventually, we plan the API to support this format as input so you could just write this in place of the JSON syntax.</p>
</div>
<h3 id="simplest-query">Simplest Query</h3>
<p>The simplest query you can write would be:</p>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT * FROM STREAM(30000, TIME) LIMIT 1;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{}
</code></pre>

<p>While not a very useful query - this will get any one event record (no filters means that any record would be matched, no projection gets the entire record, and the default aggregation is <code>LIMIT</code>or <code>RAW</code> with size 1, default duration 30000 ms), this can be used to quickly test your connection to Bullet.</p>
<div class="admonition note">
<p class="admonition-title">WINDOW?</p>
<p>There is only one unified data stream in Bullet, so for clarity the <code>FROM</code> clause is replaced with a non-existent <code>WINDOW</code> function to denote the look-forward time window for the Bullet query. For the <code>SQL</code> examples, we pretend that this function understands various time granularities as well.</p>
</div>
<h3 id="simple-filtering">Simple Filtering</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT *
FROM STREAM(30000, TIME)
WHERE id = 'btsg8l9b234ha'
LIMIT 1;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;filters&quot;:[
       {
           &quot;field&quot;:&quot;id&quot;,
           &quot;operation&quot;:&quot;==&quot;,
           &quot;values&quot;:[
               &quot;btsg8l9b234ha&quot;
           ]
       }
    ]
}
</code></pre>

<p>Because of the default constraints, this query would find at most 1 record with the id matching the value provided. The record would have all its fields.</p>
<p>A sample response could be (it has been edited to remove PII and other Yahoo data). The response contains a single matching record, and the associated meta information.</p>
<pre><code class="javascript">{
   &quot;records&quot;:[
       {
           &quot;server_name&quot;:&quot;EDITED&quot;,
           &quot;page_uri&quot;:&quot;/&quot;,
           &quot;is_page_view&quot;:true,
           &quot;device&quot;:&quot;tablet&quot;,
           &quot;debug_codes&quot;:{
               &quot;http_status_code&quot;:&quot;200&quot;
           },
           &quot;referrer_domain&quot;:&quot;www.yahoo.com&quot;,
           &quot;is_logged_in&quot;:true,
           &quot;timestamp&quot;:1446842189000,
           &quot;event_family&quot;:&quot;view&quot;,
           &quot;id&quot;:&quot;btsg8l9b234ha&quot;,
           &quot;os_name&quot;:&quot;mac os&quot;,
           &quot;demographics&quot;:{
               &quot;age&quot; : &quot;25&quot;,
               &quot;gender&quot; : &quot;m&quot;,
            }
       }
    ],
    &quot;meta&quot;:{
        &quot;query_id&quot;:1167304238598842449,
        &quot;query_body&quot;:&quot;{}&quot;,
        &quot;query_finish_time&quot;:1480723799550,
        &quot;query_receive_time&quot;:1480723799540
    }
}
</code></pre>

<h3 id="relational-filters-and-projections">Relational Filters and Projections</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT timestamp AS ts, device_timestamp AS device_ts,
       event AS event, page_domain AS domain, page_id AS id
FROM STREAM(20000, TIME)
WHERE id = 'btsg8l9b234ha' AND page_id IS NOT NULL
LIMIT 10;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
    &quot;filters&quot;:[
        {
            &quot;field&quot;:&quot;id&quot;,
            &quot;operation&quot;:&quot;==&quot;,
            &quot;values&quot;:[
                &quot;btsg8l9b234ha&quot;
            ]
        },
        {
            &quot;field&quot;:&quot;page_id&quot;,
            &quot;operation&quot;:&quot;!=&quot;,
            &quot;values&quot;:[
                &quot;null&quot;
            ]
        }
    ],
    &quot;projection&quot;:{
        &quot;fields&quot;:{
            &quot;timestamp&quot;:&quot;ts&quot;,
            &quot;device_timestamp&quot;:&quot;device_ts&quot;,
            &quot;event&quot;:&quot;event&quot;,
            &quot;page_domain&quot;:&quot;domain&quot;,
            &quot;page_id&quot;:&quot;id&quot;
        }
    },
    &quot;aggregation&quot;:{
        &quot;type&quot;:&quot;RAW&quot;,
        &quot;size&quot;:10
    },
    &quot;duration&quot;:20000
}
</code></pre>

<p>The above query finds all events with id set to 'btsg8l9b234ha' and page_id is not null, projects out the fields listed above with their new names (timestamp becomes ts etc) and limits the results to at most 10 such records. <code>RAW</code> indicates that the complete raw record fields will be returned, and more complicated aggregations such as <code>COUNT</code> or <code>SUM</code> will not be performed. The duration would set the query to wait at most 20 seconds for records to show up.</p>
<p>The resulting response could look like (only 3 events were generated that matched the criteria):</p>
<pre><code class="javascript">{
    &quot;records&quot;: [
        {
            &quot;domain&quot;: &quot;http://some.url.com&quot;,
            &quot;device_ts&quot;: 1481152233788,
            &quot;id&quot;: 2273844742998,
            &quot;event&quot;: &quot;page&quot;,
            &quot;ts&quot;: null
        },
        {
            &quot;domain&quot;: &quot;www.yahoo.com&quot;,
            &quot;device_ts&quot;: 1481152233788,
            &quot;id&quot;: 227384472956,
            &quot;event&quot;: &quot;click&quot;,
            &quot;ts&quot;: 1481152233888
        },
        {
            &quot;domain&quot;: &quot;https://news.yahoo.com&quot;,
            &quot;device_ts&quot;: null,
            &quot;id&quot;: 2273844742556,
            &quot;event&quot;: &quot;page&quot;,
            &quot;ts&quot;: null
        }
    ],
    &quot;meta&quot;: {
        &quot;query_id&quot;: -3239746252817510000,
        &quot;query_body&quot;: &quot;&lt;EDITED OUT&gt;&quot;,
        &quot;query_finish_time&quot;: 1481152233799,
        &quot;query_receive_time&quot;: 1481152233796
    }
}
</code></pre>

<h3 id="logical-filters-and-projections">Logical Filters and Projections</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT id AS id, experience AS experience, page_id AS pid,
       link_id AS lid, tags AS tags, demographics.age AS age
FROM STREAM(60000, TIME)
WHERE (id = 'c14plm1begla7' AND ((experience = 'web' AND page_id IN ('18025', '47729'))
                                  OR link_id LIKE ('2.*')))
      OR (tags.player='true' AND demographics.age &gt; '65')
LIMIT 1;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
 &quot;filters&quot;: [
                {
                    &quot;operation&quot;: &quot;OR&quot;,
                    &quot;clauses&quot;: [
                        {
                            &quot;operation&quot;: &quot;AND&quot;,
                            &quot;clauses&quot;: [
                                {
                                    &quot;field&quot;: &quot;id&quot;,
                                    &quot;operation&quot;: &quot;==&quot;,
                                    &quot;values&quot;: [&quot;c14plm1begla7&quot;]
                                },
                                {
                                    &quot;operation&quot;: &quot;OR&quot;,
                                    &quot;clauses&quot;: [
                                        {
                                            &quot;operation&quot;: &quot;AND&quot;,
                                            &quot;clauses&quot;: [
                                                {
                                                    &quot;field&quot;: &quot;experience&quot;,
                                                    &quot;operation&quot;: &quot;==&quot;,
                                                    &quot;values&quot;: [&quot;web&quot;]
                                                },
                                                {
                                                    &quot;field&quot;: &quot;page_id&quot;,
                                                    &quot;operation&quot;: &quot;==&quot;,
                                                    &quot;values&quot;: [&quot;18025&quot;, &quot;47729&quot;]
                                                }
                                            ]
                                        },
                                        {
                                            &quot;field&quot;: &quot;link_id&quot;,
                                            &quot;operation&quot;: &quot;RLIKE&quot;,
                                            &quot;values&quot;: [&quot;2.*&quot;]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            &quot;operation&quot;: &quot;AND&quot;,
                            &quot;clauses&quot;: [
                                {
                                    &quot;field&quot;: &quot;tags.player&quot;,
                                    &quot;operation&quot;: &quot;==&quot;,
                                    &quot;values&quot;: [&quot;true&quot;]
                                },
                                {
                                    &quot;field&quot;: &quot;demographics.age&quot;,
                                    &quot;operation&quot;: &quot;&gt;&quot;,
                                    &quot;values&quot;: [&quot;65&quot;]
                                }
                            ]
                        }
                    ]
                }
            ],
 &quot;projection&quot; : {
    &quot;fields&quot;: {
        &quot;id&quot;: &quot;id&quot;,
        &quot;experience&quot;: &quot;experience&quot;,
        &quot;page_id&quot;: &quot;pid&quot;,
        &quot;link_id&quot;: &quot;lid&quot;,
        &quot;tags&quot;: &quot;tags&quot;,
        &quot;demographics.age&quot;: &quot;age&quot;
    }
 },
 &quot;aggregation&quot;: {&quot;type&quot; : &quot;RAW&quot;, &quot;size&quot; : 1},
 &quot;duration&quot;: 60000
}
</code></pre>

<div class="admonition note">
<p class="admonition-title">Typing</p>
<p>If demographics["age"] was of type Long, then Bullet will convert 85 to be an Long, but in this example, we are pretending that it is String.  So, no conversion is made. Similarly for link_id, id, experience and page_id. tags is a Map of String to Boolean so Bullet converts <code>"true"</code> to the Boolean <code>true</code>.</p>
</div>
<p>This query is looking for a single event with a specific id and either the page_id is in two specific pages on the "web" experience or with a link_id that starts with 2, or a player event where the age is greater than "65". In other words, it is looking for senior citizens who generate video player events or a particular person's (based on id) events on two specific pages or a group of pages that have link that have ids that start with 2. It then projects out only these fields with different names.</p>
<p>A sample result could look like (it matched because of tags.player was true and demographics.age was &gt; 65):</p>
<pre><code class="javascript">{
    &quot;records&quot;: [
        {
            &quot;pid&quot;:&quot;158&quot;,
            &quot;id&quot;:&quot;0qcgofdbfqs9s&quot;,
            &quot;experience&quot;:&quot;web&quot;,
            &quot;lid&quot;:&quot;978500434&quot;,
            &quot;age&quot;:&quot;66&quot;,
            &quot;tags&quot;:{&quot;player&quot;:true}
        }
    ],
    &quot;meta&quot;: {
        &quot;query_id&quot;: 3239746252812284004,
        &quot;query_body&quot;: &quot;&lt;EDITED OUT&gt;&quot;,
        &quot;query_finish_time&quot;: 1481152233805,
        &quot;query_receive_time&quot;: 1481152233881
    }
}
</code></pre>

<h3 id="group-all-count-aggregation">GROUP ALL COUNT Aggregation</h3>
<p>An example of a query performing a COUNT all records aggregation would look like:</p>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT COUNT(*) AS numSeniors
FROM STREAM(20000, TIME)
WHERE demographics.age &gt; 65
GROUP BY ();
</code></pre>

<p>Note that the <code>GROUP BY ()</code> is optional.</p>
<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;filters&quot;:[
      {
         &quot;field&quot;:&quot;demographics.age&quot;,
         &quot;operation&quot;:&quot;&gt;&quot;,
         &quot;values&quot;:[
            &quot;65&quot;
         ]
      }
   ],
   &quot;aggregation&quot;:{
      &quot;type&quot;:&quot;GROUP&quot;,
      &quot;attributes&quot;:{
         &quot;operations&quot;:[
            {
               &quot;type&quot;:&quot;COUNT&quot;,
               &quot;newName&quot;:&quot;numSeniors&quot;
            }
         ]
      }
   },
   &quot;duration&quot;:20000
}
</code></pre>

<p>This query will count the number events for which demographics.age &gt; 65. The aggregation type GROUP indicates that it is a group aggregation. To group by a key, the <code>fields</code> key needs to be set in the <code>aggregation</code> part of the query. If <code>fields</code> is empty or is omitted (as it is in the query above) and the <code>type</code> is <code>GROUP</code>, it is as if all the records are collapsed into a single group - a <code>GROUP ALL</code>. Adding a <code>COUNT</code> in the <code>operations</code> part of the <code>attributes</code> indicates that the number of records in this group will be counted, and the "newName" key denotes the name the resulting column "numSeniors" in the result. Setting the duration to 20000 counts matching records for
this duration.</p>
<p>A sample result would look like:</p>
<pre><code class="javascript">{
    &quot;records&quot;: [
        {
            &quot;numSeniors&quot;: 363201
        }
    ],
    &quot;meta&quot;: {}
}
</code></pre>

<p>This result indicates that 363,201 records were counted with demographics.age &gt; 65 during the 20s the query was running.</p>
<h3 id="group-all-multiple-aggregations">GROUP ALL Multiple Aggregations</h3>
<p>COUNT is the only GROUP operation for which you can omit a "field".</p>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT COUNT(*) AS numCalifornians, AVG(demographics.age) AS avgAge,
       MIN(demographics.age) AS minAge, MAX(demographics.age) AS maxAge
FROM STREAM(20000, TIME)
WHERE demographics.state = 'california'
GROUP BY ();
</code></pre>

<p>Note that the <code>GROUP BY ()</code> is optional.</p>
<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;filters&quot;:[
      {
         &quot;field&quot;:&quot;demographics.state&quot;,
         &quot;operation&quot;:&quot;==&quot;,
         &quot;values&quot;:[
            &quot;california&quot;
         ]
      }
   ],
   &quot;aggregation&quot;:{
      &quot;type&quot;:&quot;GROUP&quot;,
      &quot;attributes&quot;:{
         &quot;operations&quot;:[
            {
               &quot;type&quot;:&quot;COUNT&quot;,
               &quot;newName&quot;:&quot;numCalifornians&quot;
            },
            {
               &quot;type&quot;:&quot;AVG&quot;,
               &quot;field&quot;:&quot;demographics.age&quot;,
               &quot;newName&quot;:&quot;avgAge&quot;
            },
            {
               &quot;type&quot;:&quot;MIN&quot;,
               &quot;field&quot;:&quot;demographics.age&quot;,
               &quot;newName&quot;:&quot;minAge&quot;
            },
            {
               &quot;type&quot;:&quot;MAX&quot;,
               &quot;field&quot;:&quot;demographics.age&quot;,
               &quot;newName&quot;:&quot;maxAge&quot;
            }
         ]
      }
   },
   &quot;duration&quot;:20000
}
</code></pre>

<p>A sample result would look like:</p>
<pre><code class="javascript">{
    &quot;records&quot;: [
        {
            &quot;maxAge&quot;: 94.0,
            &quot;numCalifornians&quot;: 188451,
            &quot;minAge&quot;: 6.0,
            &quot;avgAge&quot;: 33.71828
        }
    ],
    &quot;meta&quot;: {
        &quot;query_id&quot;: 8051040987827161000,
        &quot;query_body&quot;: &quot;&lt;EDITED OUT&gt;&quot;,
        &quot;query_finish_time&quot;: 1482371927435,
        &quot;query_receive_time&quot;: 1482371916625
    }
}
</code></pre>

<p>This result indicates that, among the records observed during the 20s this query ran, there were 188,451 users with demographics.state equal to "california". Among these users the average age was 33.71828, the max age observed was 94, and the minimum age observed was 6.</p>
<h3 id="exact-count-distinct-aggregation">Exact COUNT DISTINCT Aggregation</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT COUNT(DISTINCT browser_name, browser_version) AS &quot;COUNT DISTINCT&quot;
FROM STREAM(10000, TIME);
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;aggregation&quot;:{
      &quot;type&quot;:&quot;COUNT DISTINCT&quot;,
      &quot;fields&quot;:{
         &quot;browser_name&quot;:&quot;&quot;,
         &quot;browser_version&quot;:&quot;&quot;
      }
   }
}
</code></pre>

<p>This gets the count of the unique browser names and versions in the next 30s (default duration). Note that we do not specify values for the keys in fields. This is because they are not relevant</p>
<pre><code class="javascript">{
    &quot;records&quot;: [
        {
            &quot;COUNT DISTINCT&quot;: 158.0
        }
    ],
    &quot;meta&quot;: {
        &quot;query_id&quot;: 4451146261377394443,
        &quot;sketches&quot;: {
            &quot;standard_deviations&quot;: {
                &quot;1&quot;: {
                    &quot;upperBound&quot;: 158.0,
                    &quot;lowerBound&quot;: 158.0
                },
                &quot;2&quot;: {
                    &quot;upperBound&quot;: 158.0,
                    &quot;lowerBound&quot;: 158.0
                },
                &quot;3&quot;: {
                    &quot;upperBound&quot;: 158.0,
                    &quot;lowerBound&quot;: 158.0
                }
            },
            &quot;was_estimated&quot;: false,
            &quot;family&quot;: &quot;THETA&quot;,
            &quot;theta&quot;: 1.0,
            &quot;size&quot;: 1280
        },
        &quot;query_body&quot;: &quot;&lt;EDITED OUT&gt;&quot;,
        &quot;query_finish_time&quot;: 1484084869073,
        &quot;query_receive_time&quot;: 1484084832684
    }
}
</code></pre>

<p>There were 158 unique combinations on browser names and versions in our dataset for those 30 s. Note the new <code>sketches</code> object in the meta. It has various metadata about the result. In particular, the <code>was_estimated</code> key denotes where the result
was estimated or not. The <code>standard_deviations</code> key denotes the confidence at various sigmas: 1 (1 sigma = ~68% confidence, 2 sigma = ~95% confidence, 3 sigma = ~99% confidence). Since this result was not estimated, the result is the same as the upper and lower bounds for the result.</p>
<h3 id="approximate-count-distinct">Approximate COUNT DISTINCT</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT COUNT(DISTINCT ip_address) AS uniqueIPs
FROM STREAM(10000, TIME);
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;aggregation&quot;:{
      &quot;type&quot;:&quot;COUNT DISTINCT&quot;,
      &quot;fields&quot;:{
         &quot;ip_address&quot;:&quot;&quot;
      },
      &quot;attributes&quot;:{
         &quot;newName&quot;:&quot;uniqueIPs&quot;
      }
   },
   &quot;duration&quot;:10000
}
</code></pre>

<p>This query gets us the unique IP addresses in the next 10 s. It renames the result column from "COUNT DISTINCT" to "uniqueIPs".</p>
<pre><code class="javascript">{
   &quot;records&quot;:[
      {
         &quot;uniqueIPs&quot;:130551.07952805843
      }
   ],
   &quot;meta&quot;:{
      &quot;query_id&quot;:5377782455857451480,
      &quot;sketches&quot;:{
         &quot;standard_deviations&quot;:{
            &quot;1&quot;:{
               &quot;upperBound&quot;:131512.85413760383,
               &quot;lowerBound&quot;:129596.30223107953
            },
            &quot;2&quot;:{
               &quot;upperBound&quot;:132477.15103015225,
               &quot;lowerBound&quot;:128652.93906100772
            },
            &quot;3&quot;:{
               &quot;upperBound&quot;:133448.49248615955,
               &quot;lowerBound&quot;:127716.46773622213
            }
         },
         &quot;was_estimated&quot;:true,
         &quot;family&quot;:&quot;THETA&quot;,
         &quot;theta&quot;:0.12549877074343688,
         &quot;size&quot;:131096
      },
      &quot;query_body&quot;:&quot;&lt;EDITED OUT&gt;&quot;,
      &quot;query_finish_time&quot;:1484090240812,
      &quot;query_receive_time&quot;:1484090223351
   }
}
</code></pre>

<p>The number of unique IPs in our dataset was 130551 in those 10s (approximately) with the true value between (129596, 131512) at 68% confidence, (128652, 132477) at 95% confidence and (127716, 133448) at 99% confidence. In the <em>worst</em> case at 3 sigma (99% confidence),
our error is 2.17%. The final result was computed with 131096 bytes or ~128 KiB as denoted by <code>size</code>. This happens to be maximum size the the COUNT DISTINCT sketch will take up at the default nominal entries, so even if we had billions of unique IPs, the size will be the same and the error may be higher (depends on the distribution). For example, the error when the same query was run for 30s was 2.28% at 99% confidence (actual unique IPs: 559428, upper bound: 572514). In fact, the worst the error can get at this
Sketch size is 2.34% as defined <a href="https://datasketches.github.io/docs/Theta/ThetaErrorTable.html">here</a>, <em>regardless of the number of unique entries added to the Sketch!</em>.</p>
<h3 id="distinct-aggregation">DISTINCT Aggregation</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT browser_name AS browser
FROM STREAM(30000, TIME)
GROUP BY browser_name
LIMIT 10;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;aggregation&quot;:{
      &quot;type&quot;:&quot;DISTINCT&quot;,
      &quot;size&quot;:10,
      &quot;fields&quot;:{
         &quot;browser_name&quot;:&quot;browser&quot;
      }
   }
}
</code></pre>

<p>This query gets the distinct values for the browser_name field and limit the results to 10. It runs for 30 s.</p>
<pre><code class="javascript">{
   &quot;records&quot;:[
      {
         &quot;browser&quot;:&quot;opera&quot;
      },
      {
         &quot;browser&quot;:&quot;flock&quot;
      },
      {
         &quot;browser&quot;:&quot;links&quot;
      },
      {
         &quot;browser&quot;:&quot;mozilla firefox&quot;
      },
      {
         &quot;browser&quot;:&quot;dolfin&quot;
      },
      {
         &quot;browser&quot;:&quot;lynx&quot;
      },
      {
         &quot;browser&quot;:&quot;chrome&quot;
      },
      {
         &quot;browser&quot;:&quot;microsoft internet explorer&quot;
      },
      {
         &quot;browser&quot;:&quot;aol browser&quot;
      },
      {
         &quot;browser&quot;:&quot;edge&quot;
      }
   ],
   &quot;meta&quot;:{
      &quot;query_id&quot;:-4872093887360741287,
      &quot;sketches&quot;:{
         &quot;standard_deviations&quot;:{
            &quot;1&quot;:{
               &quot;upperBound&quot;:28.0,
               &quot;lowerBound&quot;:28.0
            },
            &quot;2&quot;:{
               &quot;upperBound&quot;:28.0,
               &quot;lowerBound&quot;:28.0
            },
            &quot;3&quot;:{
               &quot;upperBound&quot;:28.0,
               &quot;lowerBound&quot;:28.0
            }
         },
         &quot;was_estimated&quot;:false,
         &quot;family&quot;:&quot;TUPLE&quot;,
         &quot;uniques_estimate&quot;:28.0,
         &quot;theta&quot;:1.0
      },
      &quot;query_body&quot;:&quot;&lt;EDITED OUT&gt;&quot;,
      &quot;query_finish_time&quot;:1485469087971,
      &quot;query_receive_time&quot;:1485469054070
   }
}
</code></pre>

<p>There were 28 unique results but we asked for 10, so the query returned a uniform sample across the 28 distinct values.</p>
<p>DISTINCT is just an alias for GROUP. A GROUP by with no operations is exactly a DISTINCT.</p>
<h3 id="group-by-aggregation">GROUP by Aggregation</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT demographics.country AS country, device AS device,
       COUNT(*) AS count, AVG(demographics.age) AS averageAge,
       AVG(timespent) AS averageTimespent
FROM STREAM(20000, TIME)
WHERE demographics IS NOT NULL
GROUP BY demographics.country, device
LIMIT 50;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;filters&quot;:[
      {
         &quot;field&quot;:&quot;demographics&quot;,
         &quot;operation&quot;:&quot;!=&quot;,
         &quot;values&quot;:[
            &quot;null&quot;
         ]
      }
   ],
   &quot;aggregation&quot;:{
      &quot;type&quot;:&quot;GROUP&quot;,
      &quot;size&quot;:50,
      &quot;fields&quot;:{
         &quot;demographics.country&quot;:&quot;country&quot;,
         &quot;device&quot;:&quot;&quot;
      },
      &quot;attributes&quot;:{
         &quot;operations&quot;:[
            {
               &quot;type&quot;:&quot;COUNT&quot;,
               &quot;newName&quot;:&quot;count&quot;
            },
            {
               &quot;type&quot;:&quot;AVG&quot;,
               &quot;field&quot;:&quot;demographics.age&quot;,
               &quot;newName&quot;:&quot;averageAge&quot;
            },
            {
               &quot;type&quot;:&quot;AVG&quot;,
               &quot;field&quot;:&quot;timespent&quot;,
               &quot;newName&quot;:&quot;averageTimespent&quot;
            }
         ]
      }
   },
   &quot;duration&quot;:20000
}
</code></pre>

<p>This query groups by the country and the device and for each unique group gets the count, average age and time spent by the users for the next 20 seconds. It renames demographics.country to country and does not rename device. It limits the groups to 50. If there were more than
50 groups, the results would be a uniform sampling of the groups (but each group in the result would have the correct result). These parameters can all be tweaked <a href="#configuration">in the configuration</a>.</p>
<pre><code class="javascript">{
   &quot;records&quot;:[
      {
         &quot;country&quot;:&quot;uk&quot;,
         &quot;device&quot;:&quot;desktop&quot;,
         &quot;count&quot;:203034,
         &quot;averageAge&quot;:32.42523,
         &quot;averageTimespent&quot;:1.342
      },
      {
         &quot;country&quot;:&quot;us&quot;,
         &quot;device&quot;:&quot;desktop&quot;,
         &quot;count&quot;:1934030,
         &quot;averageAge&quot;:29.42523,
         &quot;averageTimespent&quot;:3.234520
      },
      &quot;...EDITED 41 other such records out for readability...&quot;,
   ],
   &quot;meta&quot;:{
      &quot;query_id&quot;:1705911449584057747,
      &quot;sketches&quot;:{
         &quot;standard_deviations&quot;:{
            &quot;1&quot;:{
               &quot;upperBound&quot;:43.0,
               &quot;lowerBound&quot;:43.0
            },
            &quot;2&quot;:{
               &quot;upperBound&quot;:43.0,
               &quot;lowerBound&quot;:43.0
            },
            &quot;3&quot;:{
               &quot;upperBound&quot;:43.0,
               &quot;lowerBound&quot;:43.0
            }
         },
         &quot;was_estimated&quot;:false,
         &quot;family&quot;:&quot;TUPLE&quot;,
         &quot;uniques_estimate&quot;:43.0,
         &quot;theta&quot;:1.0
      },
      &quot;query_body&quot;:&quot;&lt;EDITED OUT&gt;&quot;,
      &quot;query_finish_time&quot;:1485217172780,
      &quot;query_receive_time&quot;:1485217148840
   }
}
</code></pre>

<p>We received 43 rows for this result. The maximum groups that was allowed for the instance of Bullet was 512. If there were more groups than the maximum specified by your configuration, <strong>a uniform sample</strong> across them would be chosen
for the result. However, for each group, the values computed (average, count) would be exact. The standard deviations, whether the result was estimated and the number of approximate uniques in the metadata would reflect the change.</p>
<p>If you asked for 50 rows in the aggregation (as the query did above) but there were more than 50 in the result (but &lt; 512), the metadata would reflect the fact that the result was not estimated. You would still get a uniform sample
but by increasing your aggregation size higher, you could get the rest.</p>
<p>For readability, if you were just trying to get the unique values for a field or a set of fields, you could leave out the attributes section and specify your fields section. You could also call the type <code>DISTINCT</code> instead of
<code>GROUP</code> to make that explicit. <code>DISTINCT</code> is just an alias for <code>GROUP</code>. See <a href="#distinct-aggregation">the DISTINCT example</a>.</p>
<h3 id="quantile-distribution">QUANTILE DISTRIBUTION</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT QUANTILE(duration, LINEAR, 11)
FROM STREAM(5000, TIME)
LIMIT 11;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;aggregation&quot;:{
      &quot;type&quot;: &quot;DISTRIBUTION&quot;,
      &quot;size&quot;: 11,
      &quot;fields&quot;: {
          &quot;duration&quot;: &quot;&quot;
      },
      &quot;attributes&quot;: {
          &quot;type&quot;: &quot;QUANTILE&quot;,
          &quot;numberOfPoints&quot;: 11
      }
   },
   &quot;duration&quot;: 5000
}
</code></pre>

<p>This query creates 11 points from 0 to 1 (both inclusive) and finds the percentile values of the <code>duration</code> field (which contains an amount of time in ms) at <code>0, 0.1, 0.2 ... 1.0</code> or the 0th, 10th, 20th and 100th percentiles. It runs for 5 seconds and returns at most 11 points. As long as the <code>size</code> is set to higher than the number of points you generate, <code>DISTRIBUTION</code> queries will return all your values.</p>
<p>The SQL is not really the same since it will produce one row instead of 11.</p>
<pre><code class="javascript">{
   &quot;records&quot;:[
      {
         &quot;Value&quot;:1,
         &quot;Quantile&quot;:0
      },
      {
         &quot;Value&quot;:1352,
         &quot;Quantile&quot;:0.1
      },
      {
         &quot;Value&quot;:3045,
         &quot;Quantile&quot;:0.2
      },
      {
         &quot;Value&quot;:6501,
         &quot;Quantile&quot;:0.30000000000000004
      },
      {
         &quot;Value&quot;:10700,
         &quot;Quantile&quot;:0.4
      },
      {
         &quot;Value&quot;:17488,
         &quot;Quantile&quot;:0.5
      },
      {
         &quot;Value&quot;:28659,
         &quot;Quantile&quot;:0.6
      },
      {
         &quot;Value&quot;:47929,
         &quot;Quantile&quot;:0.7
      },
      {
         &quot;Value&quot;:83447,
         &quot;Quantile&quot;:0.7999999999999999
      },
      {
         &quot;Value&quot;:177548,
         &quot;Quantile&quot;:0.8999999999999999
      },
      {
         &quot;Value&quot;:83525609,
         &quot;Quantile&quot;:1
      }
   ],
   &quot;meta&quot;:{
      &quot;query_finish_time&quot;:1493748546533,
      &quot;query_body&quot;: &quot;&lt;EDITED OUT&gt;&quot;,
      &quot;query_id&quot;:2981902209347343400,
      &quot;sketches&quot;:{
         &quot;normalized_rank_error&quot;:0.002389303789572841,
         &quot;size&quot;:16416,
         &quot;minimum_value&quot;:1,
         &quot;items_seen&quot;:1414,
         &quot;maximum_value&quot;:83525609,
         &quot;family&quot;:&quot;QUANTILES&quot;,
         &quot;was_estimated&quot;:false
      },
      &quot;query_receive_time&quot;:1493748538259
   }
}
</code></pre>

<p>The result shows the values at the 0th, 10th percentiles etc. The <code>was_estimated</code> key indicates that the result was not approximated. Note the the <code>minimum_value</code> and the <code>maximum_value</code> correspond to the 0th and 100th percentiles. There is also a <code>normalized_rank_error</code> that describes the error (see <a href="#normalized-rank-error">below</a> for a detailed explanation) This is constant for all <code>DISTRIBUTION</code> queries and does not depend on the data or the query.</p>
<h4 id="normalized-rank-error">Normalized Rank Error</h4>
<p>Unlike <code>GROUP</code> and <code>COUNT DISTINCT</code>, the order in which the data arrives to Bullet can affect the results of a <code>DISTRIBUTION</code> query. The error when the result is estimated is not a Gaussian error function
and is not described in terms of the values of your field. In other words, if the 50th percentile was estimated to some value, you could not bound the true median by using the the estimated
value +/- constant (see below for a good approximation). The error is expressed in terms of the <em>normalized rank</em>. If one were to sort the true data stream, you would obtain a rank for each item from
0 to the stream length (<code>items_seen</code> in the metadata above). If you then divided each rank by length, you would get ranks from 0 to 1. In this domain, a <em>normalized rank error</em> of 0.002, for example, means that a value
returned for the 0.50 or 50th percentile could actually lie between 0.498 and 0.502 in the normalized ranks with 99% confidence.</p>
<p><a href="https://datasketches.github.io/docs/Quantiles/QuantilesAccuracy.html&quot;">Distribution Accuracy</a> lists the normalized rank error as a percentage for the maximum size of the Sketch used. If you obtain successive quantile values at
granularities lower than this rank error, the results may not be accurate. While the sketch speaks of the normalized rank error, you can still obtain reasonable bounds for values. For example, if the normalized rank
error was 1% and you obtained quantile values at 0.48, 0.50 and 0.52, you could use the values at 0.52 and 0.48 as very reasonable upper and lower bounds on your true median (you might even be able to use 0.49 and 0.51
if the error was 1%).</p>
<h3 id="pmf-distribution-aggregation">PMF DISTRIBUTION Aggregation</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT FREQ(duration, REGION, 2000, 20000, 500)
FROM STREAM(5000, TIME)
LIMIT 100;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;aggregation&quot;:{
      &quot;type&quot;:&quot;DISTRIBUTION&quot;,
      &quot;size&quot;:100,
      &quot;fields&quot;:{
         &quot;duration&quot;:&quot;&quot;
      },
      &quot;attributes&quot;:{
         &quot;type&quot;:&quot;PMF&quot;,
         &quot;start&quot;:2000,
         &quot;end&quot;:20000,
         &quot;increment&quot;:500
      }
   },
   &quot;duration&quot;:5000
}
</code></pre>

<p>This query creates 37 points from 2000 to 20000 in 500 increments to bucketize the duration field using these points as split locations and finds the count of duration values that fall into these intervals. It runs for 5s and returns at most 100 records (this means it will return the 38 records).</p>
<p>The SQL does not include the <em>(-&infin; to 2000)</em> and the <em>[20000 to +&infin;)</em> intervals and does not produce a probability.</p>
<pre><code class="javascript">{
   &quot;records&quot;:[
      {
         &quot;Probability&quot;:0.1518054532056006,
         &quot;Count&quot;:206,
         &quot;Range&quot;:&quot;(-∞ to 2000.0)&quot;
      },
      {
         &quot;Probability&quot;:0.0397936624907885,
         &quot;Count&quot;:53.99999999999999,
         &quot;Range&quot;:&quot;[2000.0 to 2500.0)&quot;
      },
      &quot;...EDITED 34 other such records out for readability...&quot;,
      {
         &quot;Probability&quot;:0.0058953574060427415,
         &quot;Count&quot;:8,
         &quot;Range&quot;:&quot;[19500.0 to 20000.0)&quot;
      },
      {
         &quot;Probability&quot;:0.45689019896831246,
         &quot;Count&quot;:620,
         &quot;Range&quot;:&quot;[20000.0 to +∞)&quot;
      }
   ],
   &quot;meta&quot;:{
      &quot;query_finish_time&quot;:1493750074795,
      &quot;query_body&quot;: &quot;&lt;EDITED OUT&gt;&quot;,
      &quot;query_id&quot;:-2590566941995678000,
      &quot;sketches&quot;:{
         &quot;normalized_rank_error&quot;:0.002389303789572841,
         &quot;size&quot;:16416,
         &quot;minimum_value&quot;:1,
         &quot;items_seen&quot;:1357,
         &quot;maximum_value&quot;:78240570,
         &quot;family&quot;:&quot;QUANTILES&quot;,
         &quot;was_estimated&quot;:false
      },
      &quot;query_receive_time&quot;:1493750066022
   }
}
</code></pre>

<p>The result consists of 38 records, each denoting an interval in the domain we asked for. The result was not estimated. Note that the interval is denoted by the <code>Range</code> key and the count by the <code>Count</code> key. There is also a probability that estimates how likely a value for duration is likely to fall into that range.</p>
<h3 id="cdf-distribution-aggregation">CDF DISTRIBUTION Aggregation</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT CUMFREQ(duration, MANUAL, 20000, 2000, 15000, 45000)
FROM STREAM(5000, TIME)
LIMIT 100;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;aggregation&quot;:{
      &quot;type&quot;: &quot;DISTRIBUTION&quot;,
      &quot;size&quot;: 100,
      &quot;fields&quot;: {
          &quot;duration&quot;: &quot;&quot;
      },
      &quot;attributes&quot;: {
          &quot;type&quot;: &quot;CDF&quot;,
          &quot;points&quot;: [20000, 2000, 15000, 45000]
      }
   },
   &quot;duration&quot;: 5000
}
</code></pre>

<p>This query specifies a list of points manually using <code>points</code> property in <code>attributes</code>. It runs for 5s and finds the
cumulative frequency distribution using the specified points as break points. It returns at most 100 records (which means we will
get all of the intervals).</p>
<p>There is no easy SQL equivalent because the points are free-form. It does not produce a probability field like Bullet does.</p>
<pre><code class="javascript">{
   &quot;records&quot;:[
      {
         &quot;Probability&quot;:0.14382632293080055,
         &quot;Count&quot;:212.00000000000003,
         &quot;Range&quot;:&quot;(-∞ to 2000.0)&quot;
      },
      {
         &quot;Probability&quot;:0.5210312075983717,
         &quot;Count&quot;:767.9999999999999,
         &quot;Range&quot;:&quot;(-∞ to 15000.0)&quot;
      },
      {
         &quot;Probability&quot;:0.5603799185888738,
         &quot;Count&quot;:826,
         &quot;Range&quot;:&quot;(-∞ to 20000.0)&quot;
      },
      {
         &quot;Probability&quot;:0.6994572591587517,
         &quot;Count&quot;:1031,
         &quot;Range&quot;:&quot;(-∞ to 45000.0)&quot;
      },
      {
         &quot;Probability&quot;:1,
         &quot;Count&quot;:1474,
         &quot;Range&quot;:&quot;(-∞ to +∞)&quot;
      }
   ],
   &quot;meta&quot;:{
      &quot;query_finish_time&quot;:1493755151660,
      &quot;query_body&quot;: &quot;&lt;EDITED OUT&gt;&quot;,
      &quot;query_id&quot;:-8460702488693518000,
      &quot;sketches&quot;:{
         &quot;normalized_rank_error&quot;:0.002389303789572841,
         &quot;size&quot;:16416,
         &quot;minimum_value&quot;:2,
         &quot;items_seen&quot;:1474,
         &quot;maximum_value&quot;:10851113,
         &quot;family&quot;:&quot;QUANTILES&quot;,
         &quot;was_estimated&quot;:false
      },
      &quot;query_receive_time&quot;:1493755143626
   }
}
</code></pre>

<p>The result contains the 5 intervals produced by the split points. It was not estimated so these counts are exact. Note that the start of each interval is <em>-&infin;</em> because
it is the cumulative frequency distribution.</p>
<h3 id="exact-top-k-aggregation">Exact TOP K Aggregation</h3>
<p><strong>BQL Query</strong></p>
<p>There are two methods for executing a TOP K aggregation in BQL:</p>
<pre><code class="SQL">SELECT TOP(500, 100, demographics.country, browser_name) AS numEvents
FROM STREAM(10000, TIME)
WHERE demographics.country IS NOT NULL AND browser_name IS NOT NULL;
</code></pre>

<p>OR:</p>
<pre><code class="SQL">SELECT demographics.country, browser_name, COUNT(*) AS numEvents
FROM STREAM(10000, TIME)
WHERE demographics.country IS NOT NULL AND browser_name IS NOT NULL
GROUP BY demographics.country, browser_name
HAVING COUNT(*) &gt;= 100
ORDER BY COUNT(*) DESC
LIMIT 500;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;filters&quot;:[
      {
         &quot;field&quot;: &quot;demographics.country&quot;,
         &quot;operation&quot;: &quot;!=&quot;,
         &quot;values&quot;: [&quot;null&quot;]
      },
      {
         &quot;field&quot;: &quot;browser_name&quot;,
         &quot;operation&quot;: &quot;!=&quot;,
         &quot;values&quot;: [&quot;null&quot;]
      }
   ],
   &quot;aggregation&quot;:{
      &quot;type&quot;: &quot;TOP K&quot;,
      &quot;size&quot;: 500,
      &quot;fields&quot;: {
          &quot;browser_name&quot;: &quot;browser&quot;,
          &quot;demographics.country&quot;: &quot;country&quot;
      },
      &quot;attributes&quot;: {
          &quot;threshold&quot;: 100,
          &quot;newName&quot;: &quot;numEvents&quot;
      }
   },
   &quot;duration&quot;: 10000
}
</code></pre>

<p>This query gets the top 500 country, browser combinations where the count of records for each combination is at least 100. It runs for 10s.</p>
<pre><code class="javascript">{
   &quot;records&quot;:[
      {
         &quot;country&quot;:&quot;us&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:2729
      },
      {
         &quot;country&quot;:&quot;us&quot;,
         &quot;browser&quot;:&quot;mozilla firefox&quot;,
         &quot;numEvents&quot;:1072
      },
      {
         &quot;country&quot;:&quot;uk&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:703
      },
      {
         &quot;country&quot;:&quot;fr&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:383
      },
      {
         &quot;country&quot;:&quot;fr&quot;,
         &quot;browser&quot;:&quot;mozilla firefox&quot;,
         &quot;numEvents&quot;:278
      },
      {
         &quot;country&quot;:&quot;es&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:234
      },
      &quot;...EDITED 10 other such records here for readability&quot;,
      {
         &quot;country&quot;:&quot;es&quot;,
         &quot;browser&quot;:&quot;mozilla firefox&quot;,
         &quot;numEvents&quot;:102
      },
      {
         &quot;country&quot;:&quot;fr&quot;,
         &quot;browser&quot;:&quot;apple safari&quot;,
         &quot;numEvents&quot;:101
      }
   ],
   &quot;meta&quot;:{
      &quot;query_finish_time&quot;:1493760034414,
      &quot;query_body&quot;: &quot;&lt;EDITED OUT&gt;&quot;,
      &quot;query_id&quot;:7515243052399540000,
      &quot;sketches&quot;:{
         &quot;maximum_count_error&quot;:0,
         &quot;active_items&quot;:431,
         &quot;items_seen&quot;:10784,
         &quot;family&quot;:&quot;FREQUENCY&quot;,
         &quot;was_estimated&quot;:false
      },
      &quot;query_receive_time&quot;:1493760020807
   }
}
</code></pre>

<p>The results gave us the top 18 country, browser combinations that had counts over a 100. Note the <code>maximum_count_error</code> key in the metadata. This represents how off the count is. It is 0 because these counts are exact.
In our data stream, we only had 18 unique combinations of countries and browser names at the time the query was run.</p>
<h3 id="approximate-top-k-aggregation">Approximate TOP K Aggregation</h3>
<p><strong>BQL Query</strong></p>
<p>There are two methods for executing a TOP K aggregation in BQL:</p>
<pre><code class="SQL">SELECT TOP(10, 100, browser_name, browser_version, os_name, os_version, demographics.country, demographics.state) AS numEvents
FROM STREAM(10000, TIME)
WHERE os_name IS NOT NULL AND browser_name IS NOT NULL;
</code></pre>

<p>OR:</p>
<pre><code class="SQL">SELECT browser_name, browser_version, os_name, os_version, demographics.country, demographics.state, COUNT(*) AS numEvents
FROM STREAM(10000, TIME)
WHERE os_name IS NOT NULL AND browser_name IS NOT NULL
GROUP BY browser_name, browser_version, os_name, os_version, demographics.country, demographics.state
HAVING COUNT(*) &gt;= 100
ORDER BY COUNT(*) DESC
LIMIT 10;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;filters&quot;:[
      {
         &quot;field&quot;: &quot;browser_name&quot;,
         &quot;operation&quot;: &quot;!=&quot;,
         &quot;values&quot;: [&quot;null&quot;]
      },
      {
         &quot;field&quot;: &quot;os_name&quot;,
         &quot;operation&quot;: &quot;!=&quot;,
         &quot;values&quot;: [&quot;null&quot;]
      }
   ],
   &quot;aggregation&quot;:{
      &quot;type&quot;: &quot;TOP K&quot;,
      &quot;size&quot;: 10,
      &quot;fields&quot;: {
          &quot;browser_name&quot;: &quot;browser&quot;,
          &quot;browser_version&quot;: &quot;bversion&quot;,
          &quot;os_name&quot;: &quot;os&quot;,
          &quot;os_version&quot;: &quot;oversion&quot;,
          &quot;demographics.country&quot;: &quot;country&quot;,
          &quot;demographics.state&quot;: &quot;state&quot;
      },
      &quot;attributes&quot;: {
          &quot;threshold&quot;: 100,
          &quot;newName&quot;: &quot;numEvents&quot;
      }
   },
   &quot;duration&quot;: 30000
}
</code></pre>

<p>In order to make the result approximate, this query adds more dimensions to the <a href="#exact-top-k-aggregation">Exact TOP K</a> query. It runs for 30s and looks for the top <em>10</em> combinations for these events.</p>
<pre><code class="javascript">{
   &quot;records&quot;:[
      {
         &quot;country&quot;:&quot;null&quot;,
         &quot;os&quot;:&quot;mac os x&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:120823,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;56&quot;,
         &quot;oversion&quot;:&quot;10.12&quot;
      },
      {
         &quot;country&quot;:&quot;null&quot;,
         &quot;os&quot;:&quot;mac os x&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:4539,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;35&quot;,
         &quot;oversion&quot;:&quot;10.9&quot;
      },
      {
         &quot;country&quot;:&quot;us&quot;,
         &quot;os&quot;:&quot;mac os x&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:3827,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;57&quot;,
         &quot;oversion&quot;:&quot;10.12&quot;
      },
      {
         &quot;country&quot;:&quot;null&quot;,
         &quot;os&quot;:&quot;ios&quot;,
         &quot;browser&quot;:&quot;apple safari&quot;,
         &quot;numEvents&quot;:3426,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;9.0&quot;,
         &quot;oversion&quot;:&quot;9.1&quot;
      },
      {
         &quot;country&quot;:&quot;null&quot;,
         &quot;os&quot;:&quot;windows nt&quot;,
         &quot;browser&quot;:&quot;microsoft internet explorer&quot;,
         &quot;numEvents&quot;:2264,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;6.0&quot;,
         &quot;oversion&quot;:&quot;5.1&quot;
      },
      {
         &quot;country&quot;:&quot;us&quot;,
         &quot;os&quot;:&quot;mac os x&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:1995,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;58&quot;,
         &quot;oversion&quot;:&quot;10.12&quot;
      },
      {
         &quot;country&quot;:&quot;null&quot;,
         &quot;os&quot;:&quot;windows nt&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:1416,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;57&quot;,
         &quot;oversion&quot;:&quot;10.0&quot;
      },
      {
         &quot;country&quot;:&quot;null&quot;,
         &quot;os&quot;:&quot;windows nt&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:1327,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;58&quot;,
         &quot;oversion&quot;:&quot;10.0&quot;
      },
      {
         &quot;country&quot;:&quot;null&quot;,
         &quot;os&quot;:&quot;mac os x&quot;,
         &quot;browser&quot;:&quot;google chrome&quot;,
         &quot;numEvents&quot;:1187,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;57&quot;,
         &quot;oversion&quot;:&quot;10.12&quot;
      },
      {
         &quot;country&quot;:&quot;null&quot;,
         &quot;os&quot;:&quot;ios&quot;,
         &quot;browser&quot;:&quot;apple safari&quot;,
         &quot;numEvents&quot;:1119,
         &quot;state&quot;:&quot;null&quot;,
         &quot;bversion&quot;:&quot;4.0&quot;,
         &quot;oversion&quot;:&quot;3.0&quot;
      }
   ],
   &quot;meta&quot;:{
      &quot;query_finish_time&quot;:1493761419611,
      &quot;query_body&quot;: &quot;&lt;EDITED OUT&gt;&quot;,
      &quot;query_id&quot;:-8797534873217479000,
      &quot;sketches&quot;:{
         &quot;maximum_count_error&quot;:24,
         &quot;active_items&quot;:746,
         &quot;items_seen&quot;:187075,
         &quot;family&quot;:&quot;FREQUENCY&quot;,
         &quot;was_estimated&quot;:true
      },
      &quot;query_receive_time&quot;:1493761386294
   }
}
</code></pre>

<p>Like <code>DISTRIBUTION</code>, the distribution of the data matters for <code>TOP K</code>. Depending on the distribution, your results could produce different counts and errors bounds if approximate.</p>
<p>Since we only filtered for nulls in a couple of fields, the top results end up being fields with null values. Note that the <code>maximum_count_error</code> is now 24 and the <code>was_estimated</code> property is
set to true. 24 means that the upper bound - the lower bound for the <code>Count</code> field for each combination could be off by at most 24. Since Bullet gives you the upper bound, this means that if you
subtract 24 from it, you get the lower bound of the true count.</p>
<p>Note that this also means the order of the items could be off. If two items had <code>Count</code> within 24 of each other, it is possible that the higher one <em>may</em> actually have had a true count <em>lower</em> than
the second one and possibly be ranked higher. There is no such situation in this result set.</p>
<h3 id="window-tumbling-group-by">Window - Tumbling Group-By</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT demographics.country AS country, COUNT(*) AS count, AVG(demographics.age) AS averageAge,
       AVG(timespent) AS averageTimespent
FROM STREAM(20000, TIME)
WHERE demographics IS NOT NULL
GROUP BY demographics.country
WINDOWING(TUMBLING, 5000, TIME)
LIMIT 50;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;filters&quot;:[
      {
         &quot;field&quot;:&quot;demographics&quot;,
         &quot;operation&quot;:&quot;!=&quot;,
         &quot;values&quot;:[
            &quot;null&quot;
         ]
      }
   ],
   &quot;aggregation&quot;:{
      &quot;type&quot;:&quot;GROUP&quot;,
      &quot;size&quot;:5,
      &quot;fields&quot;:{
         &quot;demographics.country&quot;:&quot;country&quot;
      },
      &quot;attributes&quot;:{
         &quot;operations&quot;:[
            {
               &quot;type&quot;:&quot;COUNT&quot;,
               &quot;newName&quot;:&quot;count&quot;
            },
            {
               &quot;type&quot;:&quot;AVG&quot;,
               &quot;field&quot;:&quot;demographics.age&quot;,
               &quot;newName&quot;:&quot;averageAge&quot;
            }
         ]
      }
   },
   &quot;window&quot;:{
       &quot;emit&quot;:{
           &quot;type&quot;: &quot;TIME&quot;,
           &quot;every&quot;: 5000
       },
       &quot;include&quot;:{
           &quot;type&quot;: &quot;TIME&quot;,
           &quot;first&quot;: 5000
       }
   },
   &quot;duration&quot;:20000
}
</code></pre>

<p>This query specifies a tumbling window that will emit every 5 seconds and contain 5 seconds of data per window. Results will come back to the user every 5 seconds, and since the duration of the query is 20 seconds,
the user will receive a total of 4 results. Since the aggregation size is set to 5, each returned window will contain only 5 groups (which will be chosen randomly). The result might look like this:</p>
<pre><code class="javascript">&quot;records&quot;:[
    {
        &quot;country&quot;:&quot;Germany&quot;,
        &quot;count&quot;:1,
        &quot;averageAge&quot;:25.0
    },
    {
        &quot;country&quot;:&quot;Canada&quot;,
        &quot;count&quot;:106,
        &quot;averageAge&quot;:22.58490566037736
    },
    {
        &quot;country&quot;:&quot;USA&quot;,
        &quot;count&quot;:1,
        &quot;averageAge&quot;:28.0
    },
    {
        &quot;country&quot;:&quot;England&quot;,
        &quot;count&quot;:8,
        &quot;averageAge&quot;:34.25
    },
    {
        &quot;country&quot;:&quot;Peru&quot;,
        &quot;count&quot;:9,
        &quot;averageAge&quot;:30.0
    }
],
&quot;meta&quot;:{
    &quot;Window&quot;:{
        &quot;Number&quot;:1,
        &quot;Emit Time&quot;:1529458403038,
        &quot;Expected Emit Time&quot;:1529458403023,
        &quot;Name&quot;:&quot;Tumbling&quot;
        },
    &quot;Query&quot;:{
        &quot;ID&quot;:&quot;448d228a-1eed-471f-8777-c800cc866535&quot;,
        &quot;Receive Time&quot;:1529458398023,
        &quot;Body&quot;:&quot;...(query body)...},
        &quot;Sketch&quot;:{
            &quot;Was Estimated&quot;:false,
            &quot;Uniques Estimate&quot;:100.0,
            &quot;Family&quot;:&quot;TUPLE&quot;,
            &quot;Theta&quot;:1.0,
            &quot;Standard Deviations&quot;:{
                &quot;1&quot;:{
                    &quot;upperBound&quot;:100.0,
                    &quot;lowerBound&quot;:100.0
                },
                &quot;2&quot;:{
                    &quot;upperBound&quot;:100.0,
                    &quot;lowerBound&quot;:100.0
                },
                &quot;3&quot;:{
                    &quot;upperBound&quot;:100.0,
                    &quot;lowerBound&quot;:100.0
                }
            }
        }
    }
}


&quot;records&quot;:[  
   {  
      &quot;country&quot;:&quot;Canada&quot;,
      &quot;count&quot;:101,
      &quot;averageAge&quot;:32.742574257425744
   },
   {  
      &quot;country&quot;:&quot;ht&quot;,
      &quot;count&quot;:2,
      &quot;averageAge&quot;:32.0
   },
   {  
      &quot;country&quot;:&quot;England&quot;,
      &quot;count&quot;:16,
      &quot;averageAge&quot;:27.0625
   },
   {  
      &quot;country&quot;:&quot;Peru&quot;,
      &quot;count&quot;:8,
      &quot;averageAge&quot;:23.625
   },
   {  
      &quot;country&quot;:&quot;Bangladesh&quot;,
      &quot;count&quot;:3,
      &quot;averageAge&quot;:27.66666666666667
   }
],
&quot;meta&quot;:{  
   &quot;Window&quot;:{  
      &quot;Number&quot;:2,
      &quot;Emit Time&quot;:1529458408036,
      &quot;Expected Emit Time&quot;:1529458408023,
      &quot;Name&quot;:&quot;Tumbling&quot;
   },
   &quot;Query&quot;:{  
      &quot;ID&quot;:&quot;448d228a-1eed-471f-8777-c800cc866535&quot;,
      &quot;Receive Time&quot;:1529458398023,
      &quot;Body&quot;:&quot;...(query body)...&quot;
   },
   &quot;Sketch&quot;:{  
      &quot;Was Estimated&quot;:false,
      &quot;Uniques Estimate&quot;:98.0,
      &quot;Family&quot;:&quot;TUPLE&quot;,
      &quot;Theta&quot;:1.0,
      &quot;Standard Deviations&quot;:{  
         &quot;1&quot;:{  
            &quot;upperBound&quot;:98.0,
            &quot;lowerBound&quot;:98.0
         },
         &quot;2&quot;:{  
            &quot;upperBound&quot;:98.0,
            &quot;lowerBound&quot;:98.0
         },
         &quot;3&quot;:{  
            &quot;upperBound&quot;:98.0,
            &quot;lowerBound&quot;:98.0
         }
      }
   }
}


&quot;records&quot;:[  
   {  
      &quot;country&quot;:&quot;Canada&quot;,
      &quot;count&quot;:121,
      &quot;averageAge&quot;:27.97520661157025
   },
   {  
      &quot;country&quot;:&quot;Haiti&quot;,
      &quot;count&quot;:3,
      &quot;averageAge&quot;:39.0
   },
   {  
      &quot;country&quot;:&quot;Cabuyao laguna&quot;,
      &quot;count&quot;:2,
      &quot;averageAge&quot;:28.0
   },
   {  
      &quot;country&quot;:&quot;USA&quot;,
      &quot;count&quot;:1,
      &quot;averageAge&quot;:20.0
   },
   {  
      &quot;country&quot;:&quot;England&quot;,
      &quot;count&quot;:23,
      &quot;averageAge&quot;:40.869565217391305
   }
],
&quot;meta&quot;:{  
   &quot;Window&quot;:{  
      &quot;Number&quot;:3,
      &quot;Emit Time&quot;:1529458413031,
      &quot;Expected Emit Time&quot;:1529458413023,
      &quot;Name&quot;:&quot;Tumbling&quot;
   },
   &quot;Query&quot;:{  
      &quot;ID&quot;:&quot;448d228a-1eed-471f-8777-c800cc866535&quot;,
      &quot;Receive Time&quot;:1529458398023,
      &quot;Body&quot;:&quot;...(query body)...&quot;
   },
   &quot;Sketch&quot;:{  
      &quot;Was Estimated&quot;:false,
      &quot;Uniques Estimate&quot;:104.0,
      &quot;Family&quot;:&quot;TUPLE&quot;,
      &quot;Theta&quot;:1.0,
      &quot;Standard Deviations&quot;:{  
         &quot;1&quot;:{  
            &quot;upperBound&quot;:104.0,
            &quot;lowerBound&quot;:104.0
         },
         &quot;2&quot;:{  
            &quot;upperBound&quot;:104.0,
            &quot;lowerBound&quot;:104.0
         },
         &quot;3&quot;:{  
            &quot;upperBound&quot;:104.0,
            &quot;lowerBound&quot;:104.0
         }
      }
   }
}


&quot;records&quot;:[  
   {  
      &quot;country&quot;:&quot;Canada&quot;,
      &quot;count&quot;:117,
      &quot;averageAge&quot;:21.82051282051282
   },
   {  
      &quot;country&quot;:&quot;Azerbaijan&quot;,
      &quot;count&quot;:1,
      &quot;averageAge&quot;:30.0
   },
   {  
      &quot;country&quot;:&quot;England&quot;,
      &quot;count&quot;:13,
      &quot;averageAge&quot;:30.923076923076923
   },
   {  
      &quot;country&quot;:&quot;Congo&quot;,
      &quot;count&quot;:1,
      &quot;averageAge&quot;:32.0
   },
   {  
      &quot;country&quot;:&quot;Bangladesh&quot;,
      &quot;count&quot;:3,
      &quot;averageAge&quot;:24.333333333333336
   }
],
&quot;meta&quot;:{  
   &quot;Window&quot;:{  
      &quot;Number&quot;:4,
      &quot;Emit Time&quot;:1529458418030,
      &quot;Expected Emit Time&quot;:1529458418023,
      &quot;Name&quot;:&quot;Tumbling&quot;
   },
   &quot;Query&quot;:{  
      &quot;Finish Time&quot;:1529458418030,
      &quot;ID&quot;:&quot;448d228a-1eed-471f-8777-c800cc866535&quot;,
      &quot;Receive Time&quot;:1529458398023,
      &quot;Body&quot;:&quot;...(query body)...&quot;
   },
   &quot;Sketch&quot;:{  
      &quot;Was Estimated&quot;:false,
      &quot;Uniques Estimate&quot;:108.0,
      &quot;Family&quot;:&quot;TUPLE&quot;,
      &quot;Theta&quot;:1.0,
      &quot;Standard Deviations&quot;:{  
         &quot;1&quot;:{  
            &quot;upperBound&quot;:108.0,
            &quot;lowerBound&quot;:108.0
         },
         &quot;2&quot;:{  
            &quot;upperBound&quot;:108.0,
            &quot;lowerBound&quot;:108.0
         },
         &quot;3&quot;:{  
            &quot;upperBound&quot;:108.0,
            &quot;lowerBound&quot;:108.0
         }
      }
   }
}
</code></pre>

<h3 id="window-additive-tumbling">Window - Additive Tumbling</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT COUNT(*) AS count, AVG(demographics.age) AS averageAge,
       AVG(timespent) AS averageTimespent
FROM STREAM(20000, TIME)
WHERE demographics IS NOT NULL
GROUP BY ()
WINDOWING(EVERY, 5000, TIME, ALL)
LIMIT 50;
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{
   &quot;filters&quot;:[
      {
         &quot;field&quot;:&quot;demographics&quot;,
         &quot;operation&quot;:&quot;!=&quot;,
         &quot;values&quot;:[
            &quot;null&quot;
         ]
      }
   ],
   &quot;aggregation&quot;:{
      &quot;type&quot;:&quot;GROUP&quot;,
      &quot;attributes&quot;:{
         &quot;operations&quot;:[
            {
               &quot;type&quot;:&quot;COUNT&quot;,
               &quot;newName&quot;:&quot;count&quot;
            },
            {
               &quot;type&quot;:&quot;AVG&quot;,
               &quot;field&quot;:&quot;demographics.age&quot;,
               &quot;newName&quot;:&quot;averageAge&quot;
            }
         ]
      }
   },
   &quot;window&quot;:{
       &quot;emit&quot;:{
           &quot;type&quot;: &quot;TIME&quot;,
           &quot;every&quot;: 5000
       },
       &quot;include&quot;:{
           &quot;type&quot;: &quot;ALL&quot;
       }
   },
   &quot;duration&quot;:20000
}
</code></pre>

<p>The above query will run for 20 seconds and emit a result every 5 seconds. The result will contain the average age and the count of the records seen since the very beginning of the query. Results might look like this:</p>
<pre><code class="javascript">&quot;records&quot;:[  
   {  
      &quot;count&quot;:8493,
      &quot;averageAge&quot;:28.8828796983622
   }
],
&quot;meta&quot;:{  
   &quot;Window&quot;:{  
      &quot;Number&quot;:1,
      &quot;Emit Time&quot;:1529522392188,
      &quot;Expected Emit Time&quot;:1529522392089,
      &quot;Name&quot;:&quot;Tumbling&quot;
   },
   &quot;Query&quot;:{  
      &quot;ID&quot;:&quot;12e48fbd-a20f-4f5e-8135-0f012d9ba3ef&quot;,
      &quot;Receive Time&quot;:1529522387089,
      &quot;Body&quot;:&quot;...(query body)...&quot;
   }
}


&quot;records&quot;:[  
   {  
      &quot;count&quot;:17580,
      &quot;averageAge&quot;:29.842629482071715
   }
],
&quot;meta&quot;:{  
   &quot;Window&quot;:{  
      &quot;Number&quot;:2,
      &quot;Emit Time&quot;:1529522397191,
      &quot;Expected Emit Time&quot;:1529522397089,
      &quot;Name&quot;:&quot;Tumbling&quot;
   },
   &quot;Query&quot;:{  
      &quot;ID&quot;:&quot;12e48fbd-a20f-4f5e-8135-0f012d9ba3ef&quot;,
      &quot;Receive Time&quot;:1529522387089,
      &quot;Body&quot;:&quot;...(query body)...&quot;
   }
}


&quot;records&quot;:[  
   {  
      &quot;count&quot;:26317,
      &quot;averageAge&quot;:29.86675792835957
   }
],
&quot;meta&quot;:{  
   &quot;Window&quot;:{  
      &quot;Number&quot;:3,
      &quot;Emit Time&quot;:1529522402185,
      &quot;Expected Emit Time&quot;:1529522402089,
      &quot;Name&quot;:&quot;Tumbling&quot;
   },
   &quot;Query&quot;:{  
      &quot;ID&quot;:&quot;12e48fbd-a20f-4f5e-8135-0f012d9ba3ef&quot;,
      &quot;Receive Time&quot;:1529522387089,
      &quot;Body&quot;:&quot;...(query body)...&quot;
   }
}



&quot;records&quot;:[  
   {  
      &quot;count&quot;:35259,
      &quot;averageAge&quot;:29.8303102557552
   }
],
&quot;meta&quot;:{  
   &quot;Window&quot;:{  
      &quot;Number&quot;:4,
      &quot;Emit Time&quot;:1529522407182,
      &quot;Expected Emit Time&quot;:1529522407089,
      &quot;Name&quot;:&quot;Tumbling&quot;
   },
   &quot;Query&quot;:{  
      &quot;Finish Time&quot;:1529522407182,
      &quot;ID&quot;:&quot;12e48fbd-a20f-4f5e-8135-0f012d9ba3ef&quot;,
      &quot;Receive Time&quot;:1529522387089,
      &quot;Body&quot;:&quot;...(query body)...&quot;
   }
}
</code></pre>

<h3 id="sliding-reactive-window-with-max-duration">Sliding "Reactive" Window with Max Duration</h3>
<p><strong>BQL Query</strong></p>
<pre><code class="SQL">SELECT *
FROM STREAM(MAX, TIME)
WHERE bcookie='2siknmdd6kaqm'
WINDOWING(EVERY, 1, RECORD, FIRST, 1, RECORD)
</code></pre>

<p><strong>JSON Query</strong></p>
<pre><code class="javascript">{  
   &quot;filters&quot;:[  
      {  
         &quot;field&quot;:&quot;browser-id&quot;,
         &quot;operation&quot;:&quot;==&quot;,
         &quot;values&quot;:[  
            &quot;2siknmdd6kaqm&quot;
         ]
      }
   ],
   &quot;aggregation&quot;:{  
      &quot;size&quot;:1,
      &quot;type&quot;:&quot;RAW&quot;,
      &quot;fields&quot;:null,
      &quot;attributes&quot;:null
   },
   &quot;window&quot;:{  
      &quot;emit&quot;:{  
         &quot;type&quot;:&quot;RECORD&quot;,
         &quot;every&quot;:1
      },
      &quot;include&quot;:{  
         &quot;type&quot;:&quot;RECORD&quot;,
         &quot;first&quot;:1
      }
   },
   &quot;projection&quot;:{  
      &quot;fields&quot;:{  
         &quot;browser-id&quot;:&quot;browser-id&quot;,
         &quot;event&quot;:&quot;event&quot;,
         &quot;demographics.country&quot;:&quot;country&quot;
      }
   },
   &quot;duration&quot;:9223372036854775807
}
</code></pre>

<p>This is a query that will capture raw data, and has a sliding window of size 1. This query will return window results immedietly whenever a single record that matches the filters flows through the system. The filters in this example
will only match records from a particular browser.</p>
<p>This query will run for the maxiumum amount of time that the backend is configured to allow.</p>
<p>Results might look like this:</p>
<pre><code class="javascript">&quot;records&quot;:[  
   {  
      &quot;country&quot;:&quot;USA&quot;,
      &quot;event&quot;:&quot;page&quot;,
      &quot;browser-id&quot;:&quot;2siknmdd6kaqm&quot;
   }
],
&quot;meta&quot;:{  
   &quot;Window&quot;:{  
      &quot;Number&quot;:1,
      &quot;Size&quot;:1,
      &quot;Emit Time&quot;:1529521479235,
      &quot;Name&quot;:&quot;Sliding&quot;
   },
   &quot;Query&quot;:{  
      &quot;ID&quot;:&quot;31d65a12-ed56-4cc8-81ec-6a8bfe9301ba&quot;,
      &quot;Receive Time&quot;:1529521475015,
      &quot;Body&quot;:&quot;...(query body)... &quot;
   }
}


&quot;records&quot;:[  
   {  
      &quot;country&quot;:&quot;USA&quot;,
      &quot;event&quot;:&quot;click&quot;,
      &quot;browser-id&quot;:&quot;2siknmdd6kaqm&quot;
   }
],
&quot;meta&quot;:{  
   &quot;Window&quot;:{  
      &quot;Number&quot;:6,
      &quot;Size&quot;:1,
      &quot;Emit Time&quot;:1529521764875,
      &quot;Name&quot;:&quot;Sliding&quot;
   },
   &quot;Query&quot;:{  
      &quot;ID&quot;:&quot;e9595eb4-ea95-418b-8cff-d00736bf216f&quot;,
      &quot;Receive Time&quot;:1529521757459,
      &quot;Body&quot;:&quot;...(query body)...&quot;
   }
}

... (one result returned for each record found for as long as the backend is configured to allow) ...
</code></pre></div>
        
    </div>

    <footer class="col-md-12" >
        <hr />
        <div class="pull-left col-md-6">
            
            
        </div>
        <div class="pull-right col-md-4 text-right">
            <p>
            <small>Bullet is licensed under the <a href='https://github.com/bullet-db/bullet-core/blob/master/LICENSE'>Apache 2 license</a>.<br></small>
            
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
        </div>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
